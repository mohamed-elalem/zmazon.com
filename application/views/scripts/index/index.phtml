<?php  
$user = $this->user->read();
$col_counter  = 0;  
//var_dump($this->user->read());
//die();

?>
<div class="container">
    <div class="product-list">
    <?php foreach ($this->all_products as $product) { 
        $col_counter ++;
        if ($col_counter-1 % 3 == 0) : ?>
    
            <div class="row">
        <?php endif; ?>
                <div class="col-md-4">
                    <div class="entry-product">
                        <a href="/index/product-details/product_id/<?= $product['id'] ?>" class="Product-link">
                        <?php if ($product['percentage']): ?>
                            <span class="onsale">Sale!</span>
                        <?php endif; ?>
                        </a>
                        <div class="entry-featured">
                            <a href="/index/product-details/product_id/<?= $product['id'] ?>" class="product-link"></a>
                            <a href="/index/product-details/product_id/<?= $product['id'] ?>">
                                <img style="width:100%" src="/images/<?= $product['photo'] ?>" >
                                <div class="star-rating-container aggregate">
                                    <div class="star-rating" title="Rated <?= $product['rate'] ?> out of 5">
                                        <?php for ($i=0; $i< $product['rate'] ; $i++ ): ?>
                                            <span class="star filled"> </span>
                                        <?php endfor; ?>
                                        <?php  for ($i= $product['rate']; $i < 5; $i++): ?>
                                            <span class="star"> </span>
                                        <?php endfor; ?>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="entry-wrap">
                            <header class="entry-header">
                                <h3><a href="/index/product-details/product_id/<?= $product['id'] ?>"><?=$product['name'] ?></a>
                                </h3>
                                <span class="price">
                                <?php if ($product['percentage']): ?>
                                    <del>
                                        <span class="Price-amount amount">
                                        <span class="Price-currencySymbol">$</span> <?= $product['price'] ?> </span>
                                    </del> 
                                    <ins>
                                        <span class="Price-amount amount">
                                        <span class="Price-amount amount">$</span><?= $product['price']* ((100-$product['percentage']) / 100) ?>
                                        </span>
                                    </ins>
                                </span>
                                <?php else : ?>
                                    <ins>
                                        <span class="Price-amount amount">
                                        <span class="Price-currencySymbol">$</span><?= $product['price'] ?>
                                        </span>
                                    </ins>
                                <?php
                                endif;
                                if (!($this->user->isEmpty() )) :  
                                    if ($user->id == $product['shopping_cart_user_id'] ) : ?>
                                        <a rel="nofollow"  data-product_id = "<?= $product['id'] ?>" data-user_id = "<?= $user->id ?>" class="btn btn-primary increment-quantity">
                                            Add to cart
                                        </a>
                                    <?php
                                    else: ?>
                                        <a rel="nofollow"  data-product_id = "<?= $product['id'] ?>" data-user_id = "<?= $user->id ?>" class="btn btn-primary add-to-cart">
                                            Add to cart
                                        </a>
                                    <?php
                                    endif;
                                    if ( $user->id == $product['wishlist_user_id']  ) : ?>
                                            <a class="btn btn-danger remove-from-wishlist" data-product_id = "<?= $product['id'] ?>" data-user_id = "<?= $user->id ?>" > Remove From wish list </a>
                                    <?php
                                    else: ?>
                                            <a class="btn btn-primary add-to-wishlist" data-product_id = "<?= $product['id'] ?>" data-user_id = "<?= $user->id ?>" > Add to wish list </a>

                                    <?php    
                                    endif;
                                endif;
                                    ?>


                            </header>
                        </div>
                    </div>
                </div>
            
            <?php  if ($col_counter % 3 == 0) : ?> 
                    </div>
            <?php endif; ?>
            </div>
            <div class="x-cart-notification">
                <div class="x-cart-notification-icon loading">
                    <i class="fa fa-cart-arrow-down" aria-hidden="true"></i>
                </div>
                <div class="x-cart-notification-icon added">
                    <i class="fa fa-check" aria-hidden="true"></i>
                </div>
            </div>
     
 <?php } ?>
